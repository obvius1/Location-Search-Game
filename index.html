<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jet Lag: The Knock-Off</title>
    
    <!-- PWA Meta Tags -->
    <meta name="description" content="Location-based game in Gent - Jet Lag style">
    <meta name="theme-color" content="#2563eb">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Jet Lag Game">
    
    <!-- Icons -->
    <link rel="icon" type="image/x-icon" href="icons/favicon.ico">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="apple-touch-icon" href="icons/apple-touch-icon.png">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Map Section - Fullscreen -->
    <div id="map"></div>
    
    <!-- Bottom Controls Sheet -->
    <div id="controls-container" class="hidden">
        <div class="controls-handle" id="controls-handle">
            <div class="handle-bar"></div>
            <div class="handle-title">Controls</div>
        </div>
        <div class="controls-content" id="controls-content">
            <!-- Game Setup Section -->
            <section id="setup-section" class="card">
                <h2>ğŸ² Spel Starten</h2>
                <div class="input-group">
                    <label for="seed-input">Spel Code (seed):</label>
                    <input type="text" id="seed-input" placeholder="Voer code in of genereer...">
                    <button id="generate-seed-btn" class="btn btn-secondary">Genereer Code</button>
                </div>
                <button id="start-game-btn" class="btn btn-primary">Start Spel</button>
            </section>

            <!-- Location Check Section -->
            <section id="location-section" class="card hidden">
                <h2>ğŸ“ Locatie Instellen</h2>
                <div class="status-indicator" id="location-status">
                    <span class="status-icon">â³</span>
                    <span class="status-text">Wacht op locatie...</span>
                </div>
                <button id="get-gps-btn" class="btn btn-primary">Haal GPS Locatie Op</button>
                <div id="adjust-location-container" class="hidden">
                    <p class="info-text">ğŸ“ Versleep de <strong style="color: #22c55e;">groene marker</strong> op de kaart naar je exacte locatie</p>
                    <button id="confirm-location-btn" class="btn btn-success">Bevestig Locatie</button>
                </div>
                <div id="location-result" class="result-box hidden"></div>
            </section>

            <!-- Hider Checklist Section -->
            <section id="checklist-section" class="card hidden">
                <h2>âœ… Hider Checklist</h2>
                <p class="checklist-intro">Voordat je wegloopt, moet je de volgende taken voltooien:</p>
                <div id="checklist-items" class="checklist-items">
                    <!-- Checklist items worden dynamisch geladen -->
                </div>
                <button id="complete-checklist-btn" class="btn btn-success" disabled>âœ“ Alles Voltooid - Start Spel</button>
            </section>

            <!-- Cards Section -->
            <section id="cards-section" class="card hidden">
                <h2>ğŸƒ Speelkaarten</h2>
                <div class="view-toggle">
                    <button id="single-view-btn" class="btn-toggle active">Enkele Kaart</button>
                    <button id="flop-view-btn" class="btn-toggle">Volledige Flop</button>
                </div>
                
                <!-- Single Card View -->
                <div id="single-card-view">
                    <div class="card-counter">
                        <span>Kaart <span id="current-card-number">1</span> van <span id="total-cards">12</span></span>
                    </div>
                    <div id="current-card" class="game-card">
                        <div class="card-task"></div>
                        <div class="card-question"></div>
                    </div>
                    <div class="card-actions">
                        <button id="prev-card-btn" class="btn btn-secondary">â† Vorige</button>
                        <button id="discard-card-btn" class="btn btn-danger">âœ“ Opgelost</button>
                        <button id="next-card-btn" class="btn btn-secondary">Volgende â†’</button>
                    </div>
                </div>
                
                <!-- Flop View -->
                <div id="flop-view" class="hidden">
                    <div class="flop-stats">
                        <span>ğŸƒ <span id="flop-count">12</span> kaarten in flop</span>
                        <span>ğŸ“¦ <span id="remaining-count">0</span> kaarten in deck</span>
                        <span id="discarded-stats" class="clickable">âœ“ <span id="discarded-count">0</span> opgelost</span>
                    </div>
                    
                    <div class="flop-phase-section">
                        <h3 class="phase-header phase-1-header">ğŸŸ¢ Early Game</h3>
                        <div id="flop-phase-1" class="flop-grid"></div>
                    </div>
                    
                    <div class="flop-phase-section">
                        <h3 class="phase-header phase-2-header">ğŸŸ¡ Mid Game</h3>
                        <div id="flop-phase-2" class="flop-grid"></div>
                    </div>
                    
                    <div class="flop-phase-section">
                        <h3 class="phase-header phase-3-header">ğŸ”´ Late Game</h3>
                        <div id="flop-phase-3" class="flop-grid"></div>
                    </div>
                </div>
                
                <!-- Discarded View -->
                <div id="discarded-view" class="hidden">
                    <div class="flop-stats">
                        <button id="back-to-flop-btn" class="btn btn-secondary">â† Terug naar flop</button>
                    </div>
                    
                    <div class="flop-phase-section">
                        <h3 class="phase-header">âœ“ Opgeloste Kaarten</h3>
                        <div id="discarded-grid" class="flop-grid"></div>
                    </div>
                </div>
            </section>

            <!-- Questions Section -->
            <section id="questions-section" class="card hidden">
                <h2>â“ Automatische Antwoorden</h2>
                <div id="questions-result" class="questions-list"></div>
                
                <!-- Distance Calculator -->
                <div class="distance-calculator">
                    <h3>ğŸ§­ Afstand Calculator</h3>
                    <p class="calculator-help">Deel je locatie of check de afstand van een tegenstander</p>
                    
                    <div class="calculator-section">
                        <button id="share-location-btn" class="btn btn-primary">ğŸ“ Deel Mijn Locatie</button>
                        <div id="current-location-display" class="location-display hidden">
                            <div class="location-coords" id="share-coords-text"></div>
                        </div>
                    </div>
                    
                    <div class="calculator-divider">OF</div>
                    
                    <div class="calculator-section">
                        <label for="opponent-coords-input">CoÃ¶rdinaten van tegenstander:</label>
                        <input 
                            type="text" 
                            id="opponent-coords-input" 
                            placeholder="51.0543, 3.7234"
                            class="coords-input"
                        >
                        <button id="calculate-distance-btn" class="btn btn-secondary">ğŸ“ Bereken Afstand</button>
                        <div id="distance-result" class="distance-result hidden"></div>
                    </div>
                </div>
            </section>

            <!-- Game Info -->
            <section class="card info-section">
                <h3>â„¹ï¸ Spelinfo</h3>
                <p><strong>Speelveld:</strong> 3.5km rondom de WEC</p>
                <p><strong>Seed:</strong> <span id="current-seed">-</span></p>
                <button id="copy-seed-btn" class="btn btn-secondary btn-small hidden">ğŸ“‹ Kopieer Code</button>
                <button id="reset-game-btn" class="btn btn-danger btn-small hidden" style="margin-top: 8px;">ï¿½ï¸ Verwijder Spel</button>
            </section>
        </div>
    </div>
    <!-- Edit Answer Modal -->
    <div id="edit-answer-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Antwoord Wijzigen</h3>
                <button class="modal-close" onclick="closeEditModal()">Ã—</button>
            </div>
            <div class="modal-body">
                <div class="game-card">
                    <div id="edit-card-task" class="card-task"></div>
                    <div id="edit-card-question" class="card-question"></div>
                </div>
                <div id="edit-answer-buttons" class="answer-buttons"></div>
            </div>
        </div>
    </div>
    
    <!-- Neighborhood Answer Modal -->
    <div id="neighborhood-answer-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ğŸ˜ï¸ Wijk Antwoord</h3>
                <button class="modal-close" onclick="closeNeighborhoodModal()">Ã—</button>
            </div>
            <div class="modal-body">
                <p class="info-text">
                    <strong>Huidige wijk:</strong> <span id="current-neighborhood-display">-</span>
                </p>
                <p class="info-text" style="margin-top: 8px;">
                    Als je verplaatst bent sinds je locatie bevestigde, selecteer hieronder de correcte wijk:
                </p>
                
                <div class="input-group">
                    <label for="neighborhood-select">Selecteer wijk (jouw locatie of buurwijk):</label>
                    <select id="neighborhood-select" class="form-select">
                        <option value="">-- Kies een wijk --</option>
                    </select>
                </div>
                
                <div class="input-group">
                    <label for="neighborhood-answer">Antwoord van tegenstander:</label>
                    <select id="neighborhood-answer" class="form-select">
                        <option value="">-- Kies antwoord --</option>
                        <option value="yes">âœ… Ja, in een van die wijken</option>
                        <option value="no">âŒ Nee, niet in die wijken</option>
                    </select>
                </div>
                
                <button id="confirm-neighborhood-btn" class="btn btn-primary" style="margin-top: 16px;">Bevestig Antwoord</button>
                
                <div id="neighborhood-info" class="result-box hidden" style="margin-top: 16px;"></div>
            </div>
        </div>
    </div>
    
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="storage.js"></script>
    <script src="geoUtils.js"></script>
    <script src="cards.js"></script>
    <script src="app.js"></script>
    
    <!-- PWA Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./service-worker.js')
                    .then(registration => {
                        console.log('Service Worker registered:', registration.scope);
                    })
                    .catch(error => {
                        console.log('Service Worker registration failed:', error);
                    });
            });
        }
    </script>
</body>
</html>
